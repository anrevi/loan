import React, { useState, useMemo, useEffect } from 'react';
import { LineChart, Line, AreaChart, Area, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar } from 'recharts';
import { Calculator, TrendingUp, PiggyBank, Home, DollarSign, FileText, Info, Settings, RefreshCw } from 'lucide-react';

export default function IndianHomeLoanCalculator() {
  // Main loan parameters
  const [principal, setPrincipal] = useState(5000000);
  const [interestRate, setInterestRate] = useState(8.5);
  const [tenure, setTenure] = useState(20);
  const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);
  
  // Additional parameters
  const [processingFee, setProcessingFee] = useState(1);
  const [insurance, setInsurance] = useState(5000);
  const [prepaymentAmount, setPrepaymentAmount] = useState(0);
  const [prepaymentYear, setPrepaymentYear] = useState(5);
  const [annualIncome, setAnnualIncome] = useState(1200000);
  const [existingEMI, setExistingEMI] = useState(0);
  
  // View states
  const [activeTab, setActiveTab] = useState('calculator');
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [compareMode, setCompareMode] = useState(false);
  const [comparison, setComparison] = useState([]);
  
  // Animation state
  const [isCalculating, setIsCalculating] = useState(false);

  // Calculate EMI
  const calculateEMI = (p, r, t) => {
    const monthlyRate = r / 12 / 100;
    const months = t * 12;
    const emi = (p * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                 (Math.pow(1 + monthlyRate, months) - 1);
    return Math.round(emi);
  };

  const emi = useMemo(() => calculateEMI(principal, interestRate, tenure), 
    [principal, interestRate, tenure]);
  
  const totalAmount = emi * tenure * 12;
  const totalInterest = totalAmount - principal;
  const processingFeeAmount = (principal * processingFee) / 100;
  const totalCost = totalAmount + processingFeeAmount + (insurance * 12 * tenure);

  // Generate amortization schedule
  const generateAmortization = useMemo(() => {
    const schedule = [];
    let balance = principal;
    const monthlyRate = interestRate / 12 / 100;
    let cumulativeInterest = 0;
    let cumulativePrincipal = 0;
    
    for (let year = 1; year <= tenure; year++) {
      let yearInterest = 0;
      let yearPrincipal = 0;
      
      for (let month = 1; month <= 12; month++) {
        if (balance <= 0) break;
        
        const interestPayment = balance * monthlyRate;
        const principalPayment = emi - interestPayment;
        
        yearInterest += interestPayment;
        yearPrincipal += principalPayment;
        balance -= principalPayment;
        
        if (balance < 0) balance = 0;
      }
      
      cumulativeInterest += yearInterest;
      cumulativePrincipal += yearPrincipal;
      
      schedule.push({
        year,
        yearInterest: Math.round(yearInterest),
        yearPrincipal: Math.round(yearPrincipal),
        balance: Math.round(balance),
        cumulativeInterest: Math.round(cumulativeInterest),
        cumulativePrincipal: Math.round(cumulativePrincipal),
        totalPaid: Math.round(cumulativeInterest + cumulativePrincipal)
      });
    }
    
    return schedule;
  }, [principal, interestRate, tenure, emi]);

  // Calculate with prepayment
  const calculateWithPrepayment = useMemo(() => {
    if (prepaymentAmount === 0) return null;
    
    let balance = principal;
    const monthlyRate = interestRate / 12 / 100;
    let totalPaid = 0;
    let months = 0;
    const prepaymentMonth = prepaymentYear * 12;
    
    while (balance > 0 && months < tenure * 12) {
      months++;
      const interest = balance * monthlyRate;
      const principalPmt = emi - interest;
      balance -= principalPmt;
      totalPaid += emi;
      
      if (months === prepaymentMonth) {
        balance -= prepaymentAmount;
        totalPaid += prepaymentAmount;
      }
      
      if (balance < 0) balance = 0;
    }
    
    const savedMonths = (tenure * 12) - months;
    const savedInterest = (totalAmount + prepaymentAmount) - totalPaid;
    
    return {
      newTenure: Math.ceil(months / 12),
      totalPaid: Math.round(totalPaid),
      savedMonths,
      savedInterest: Math.round(savedInterest),
      savedYears: Math.floor(savedMonths / 12),
      remainingMonths: savedMonths % 12
    };
  }, [principal, interestRate, tenure, emi, prepaymentAmount, prepaymentYear, totalAmount]);

  // Tax benefits (Indian)
  const taxBenefits = useMemo(() => {
    const principalDeduction = Math.min(150000, generateAmortization[0]?.yearPrincipal || 0);
    const interestDeduction = Math.min(200000, generateAmortization[0]?.yearInterest || 0);
    const totalDeduction = principalDeduction + interestDeduction;
    const taxSaved = totalDeduction * 0.3; // Assuming 30% tax bracket
    
    return {
      principalDeduction,
      interestDeduction,
      totalDeduction,
      taxSaved: Math.round(taxSaved)
    };
  }, [generateAmortization]);

  // Loan eligibility
  const eligibility = useMemo(() => {
    const monthlyIncome = annualIncome / 12;
    const maxEMI = (monthlyIncome - existingEMI) * 0.5; // 50% FOIR
    const eligibleLoan = (maxEMI * Math.pow(1 + interestRate/12/100, tenure * 12) - maxEMI) / 
                         (interestRate/12/100 * Math.pow(1 + interestRate/12/100, tenure * 12));
    
    return {
      maxEMI: Math.round(maxEMI),
      eligibleLoan: Math.round(eligibleLoan),
      isEligible: emi <= maxEMI,
      utilizationRatio: ((emi / maxEMI) * 100).toFixed(1)
    };
  }, [annualIncome, existingEMI, interestRate, tenure, emi]);

  // Format currency
  const formatINR = (amount) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      maximumFractionDigits: 0
    }).format(amount);
  };

  // Add to comparison
  const addToComparison = () => {
    if (comparison.length >= 4) {
      alert('Maximum 4 scenarios can be compared');
      return;
    }
    
    setComparison([...comparison, {
      id: Date.now(),
      principal,
      rate: interestRate,
      tenure,
      emi,
      totalInterest,
      totalAmount
    }]);
  };

  // Trigger animation
  useEffect(() => {
    setIsCalculating(true);
    const timer = setTimeout(() => setIsCalculating(false), 300);
    return () => clearTimeout(timer);
  }, [principal, interestRate, tenure]);

  return (
    <div style={{
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%)',
      color: '#f1f5f9',
      fontFamily: "'Outfit', -apple-system, sans-serif",
      padding: '2rem',
      position: 'relative',
      overflow: 'hidden'
    }}>
      {/* Background decorative elements */}
      <div style={{
        position: 'absolute',
        top: '-10%',
        right: '-5%',
        width: '600px',
        height: '600px',
        background: 'radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%)',
        borderRadius: '50%',
        filter: 'blur(60px)',
        animation: 'pulse 8s ease-in-out infinite'
      }}></div>
      
      <div style={{
        position: 'absolute',
        bottom: '-15%',
        left: '-10%',
        width: '800px',
        height: '800px',
        background: 'radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%)',
        borderRadius: '50%',
        filter: 'blur(80px)',
        animation: 'pulse 10s ease-in-out infinite 2s'
      }}></div>

      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Playfair+Display:wght@700;900&display=swap');
        
        @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 0.5; }
          50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        @keyframes slideIn {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes shimmer {
          0% { background-position: -1000px 0; }
          100% { background-position: 1000px 0; }
        }
        
        .calculator-card {
          background: rgba(30, 41, 59, 0.7);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(148, 163, 184, 0.2);
          border-radius: 24px;
          padding: 2rem;
          position: relative;
          animation: slideIn 0.5s ease-out;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .calculator-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
          border-color: rgba(251, 191, 36, 0.3);
        }
        
        .input-group {
          margin-bottom: 1.5rem;
          animation: fadeIn 0.5s ease-out;
        }
        
        .slider {
          width: 100%;
          height: 8px;
          border-radius: 10px;
          background: linear-gradient(90deg, #3b82f6 0%, #fbbf24 100%);
          outline: none;
          opacity: 0.9;
          transition: opacity 0.3s;
          -webkit-appearance: none;
        }
        
        .slider:hover {
          opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 24px;
          height: 24px;
          border-radius: 50%;
          background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
          cursor: pointer;
          box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
          transition: all 0.3s;
        }
        
        .slider::-webkit-slider-thumb:hover {
          transform: scale(1.2);
          box-shadow: 0 6px 20px rgba(251, 191, 36, 0.6);
        }
        
        .slider::-moz-range-thumb {
          width: 24px;
          height: 24px;
          border-radius: 50%;
          background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
          cursor: pointer;
          box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
          border: none;
          transition: all 0.3s;
        }
        
        .slider::-moz-range-thumb:hover {
          transform: scale(1.2);
          box-shadow: 0 6px 20px rgba(251, 191, 36, 0.6);
        }
        
        .metric-card {
          background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(251, 191, 36, 0.1) 100%);
          border: 1px solid rgba(148, 163, 184, 0.15);
          border-radius: 16px;
          padding: 1.5rem;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
          overflow: hidden;
        }
        
        .metric-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
          transition: left 0.5s;
        }
        
        .metric-card:hover::before {
          left: 100%;
        }
        
        .metric-card:hover {
          transform: translateY(-4px);
          border-color: rgba(251, 191, 36, 0.3);
          box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }
        
        .tab-button {
          background: transparent;
          border: none;
          color: #94a3b8;
          padding: 0.75rem 1.5rem;
          cursor: pointer;
          transition: all 0.3s;
          border-radius: 12px;
          font-weight: 600;
          font-size: 0.95rem;
          position: relative;
        }
        
        .tab-button.active {
          background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
          color: white;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .tab-button:hover:not(.active) {
          background: rgba(59, 130, 246, 0.1);
          color: #3b82f6;
        }
        
        .btn-primary {
          background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
          color: #0f172a;
          border: none;
          padding: 0.875rem 2rem;
          border-radius: 12px;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s;
          box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
          font-size: 1rem;
        }
        
        .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }
        
        .btn-secondary {
          background: rgba(51, 65, 85, 0.6);
          color: #f1f5f9;
          border: 1px solid rgba(148, 163, 184, 0.3);
          padding: 0.875rem 2rem;
          border-radius: 12px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s;
        }
        
        .btn-secondary:hover {
          background: rgba(51, 65, 85, 0.9);
          border-color: rgba(251, 191, 36, 0.3);
        }
        
        .table-row {
          border-bottom: 1px solid rgba(148, 163, 184, 0.1);
          transition: all 0.2s;
        }
        
        .table-row:hover {
          background: rgba(59, 130, 246, 0.05);
        }
        
        input[type="number"] {
          background: rgba(15, 23, 42, 0.5);
          border: 1px solid rgba(148, 163, 184, 0.2);
          color: #f1f5f9;
          padding: 0.75rem 1rem;
          border-radius: 8px;
          width: 100%;
          font-size: 1rem;
          transition: all 0.3s;
        }
        
        input[type="number"]:focus {
          outline: none;
          border-color: #fbbf24;
          box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }
        
        .calculating {
          animation: shimmer 2s infinite;
          background: linear-gradient(90deg, transparent 0%, rgba(251, 191, 36, 0.2) 50%, transparent 100%);
          background-size: 1000px 100%;
        }
      `}</style>

      <div style={{ maxWidth: '1400px', margin: '0 auto', position: 'relative', zIndex: 1 }}>
        {/* Header */}
        <div style={{ marginBottom: '3rem', textAlign: 'center' }}>
          <h1 style={{
            fontSize: '3.5rem',
            fontFamily: "'Playfair Display', serif",
            fontWeight: 900,
            background: 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #fbbf24 100%)',
            backgroundClip: 'text',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            marginBottom: '0.5rem',
            letterSpacing: '-0.02em'
          }}>
            Smart Home Loan Calculator
          </h1>
          <p style={{
            fontSize: '1.25rem',
            color: '#94a3b8',
            fontWeight: 300
          }}>
            Complete Financial Planning Tool for Indian Home Buyers
          </p>
        </div>

        {/* Tab Navigation */}
        <div style={{
          display: 'flex',
          gap: '1rem',
          marginBottom: '2rem',
          flexWrap: 'wrap',
          justifyContent: 'center'
        }}>
          <button
            className={`tab-button ${activeTab === 'calculator' ? 'active' : ''}`}
            onClick={() => setActiveTab('calculator')}
          >
            <Calculator size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
            Calculator
          </button>
          <button
            className={`tab-button ${activeTab === 'schedule' ? 'active' : ''}`}
            onClick={() => setActiveTab('schedule')}
          >
            <FileText size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
            Amortization
          </button>
          <button
            className={`tab-button ${activeTab === 'prepayment' ? 'active' : ''}`}
            onClick={() => setActiveTab('prepayment')}
          >
            <PiggyBank size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
            Prepayment
          </button>
          <button
            className={`tab-button ${activeTab === 'eligibility' ? 'active' : ''}`}
            onClick={() => setActiveTab('eligibility')}
          >
            <TrendingUp size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
            Eligibility
          </button>
          <button
            className={`tab-button ${activeTab === 'tax' ? 'active' : ''}`}
            onClick={() => setActiveTab('tax')}
          >
            <DollarSign size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
            Tax Benefits
          </button>
        </div>

        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>
          {/* Left Column - Input Controls */}
          <div className="calculator-card">
            <h2 style={{
              fontSize: '1.75rem',
              fontWeight: 700,
              marginBottom: '2rem',
              display: 'flex',
              alignItems: 'center',
              gap: '0.75rem'
            }}>
              <Home style={{ color: '#fbbf24' }} size={28} />
              Loan Details
            </h2>

            {/* Principal Amount */}
            <div className="input-group">
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                <label style={{ fontWeight: 600, color: '#cbd5e1' }}>Loan Amount</label>
                <span style={{
                  fontSize: '1.25rem',
                  fontWeight: 700,
                  color: '#fbbf24'
                }}>{formatINR(principal)}</span>
              </div>
              <input
                type="range"
                className="slider"
                min="100000"
                max="50000000"
                step="100000"
                value={principal}
                onChange={(e) => setPrincipal(Number(e.target.value))}
              />
              <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.875rem', color: '#64748b' }}>
                <span>₹1L</span>
                <span>₹5Cr</span>
              </div>
            </div>

            {/* Interest Rate */}
            <div className="input-group">
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                <label style={{ fontWeight: 600, color: '#cbd5e1' }}>Interest Rate (p.a.)</label>
                <span style={{
                  fontSize: '1.25rem',
                  fontWeight: 700,
                  color: '#fbbf24'
                }}>{interestRate.toFixed(2)}%</span>
              </div>
              <input
                type="range"
                className="slider"
                min="6"
                max="15"
                step="0.1"
                value={interestRate}
                onChange={(e) => setInterestRate(Number(e.target.value))}
              />
              <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.875rem', color: '#64748b' }}>
                <span>6%</span>
                <span>15%</span>
              </div>
            </div>

            {/* Loan Tenure */}
            <div className="input-group">
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                <label style={{ fontWeight: 600, color: '#cbd5e1' }}>Loan Tenure</label>
                <span style={{
                  fontSize: '1.25rem',
                  fontWeight: 700,
                  color: '#fbbf24'
                }}>{tenure} Years</span>
              </div>
              <input
                type="range"
                className="slider"
                min="1"
                max="30"
                step="1"
                value={tenure}
                onChange={(e) => setTenure(Number(e.target.value))}
              />
              <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.875rem', color: '#64748b' }}>
                <span>1 Year</span>
                <span>30 Years</span>
              </div>
            </div>

            {/* Advanced Options Toggle */}
            <button
              onClick={() => setShowAdvanced(!showAdvanced)}
              style={{
                background: 'transparent',
                border: '1px solid rgba(148, 163, 184, 0.3)',
                color: '#3b82f6',
                padding: '0.75rem',
                borderRadius: '8px',
                width: '100%',
                cursor: 'pointer',
                marginTop: '1rem',
                fontWeight: 600,
                transition: 'all 0.3s'
              }}
            >
              <Settings size={18} style={{ display: 'inline', marginRight: '0.5rem' }} />
              {showAdvanced ? 'Hide' : 'Show'} Advanced Options
            </button>

            {/* Advanced Options */}
            {showAdvanced && (
              <div style={{
                marginTop: '1.5rem',
                padding: '1.5rem',
                background: 'rgba(15, 23, 42, 0.5)',
                borderRadius: '12px',
                border: '1px solid rgba(148, 163, 184, 0.1)'
              }}>
                <h3 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#cbd5e1' }}>
                  Additional Costs
                </h3>
                
                <div className="input-group">
                  <label style={{ fontWeight: 600, color: '#cbd5e1', fontSize: '0.9rem' }}>
                    Processing Fee (%)
                  </label>
                  <input
                    type="number"
                    min="0"
                    max="5"
                    step="0.1"
                    value={processingFee}
                    onChange={(e) => setProcessingFee(Number(e.target.value))}
                  />
                </div>

                <div className="input-group">
                  <label style={{ fontWeight: 600, color: '#cbd5e1', fontSize: '0.9rem' }}>
                    Annual Insurance (₹)
                  </label>
                  <input
                    type="number"
                    min="0"
                    step="1000"
                    value={insurance}
                    onChange={(e) => setInsurance(Number(e.target.value))}
                  />
                </div>

                <div className="input-group">
                  <label style={{ fontWeight: 600, color: '#cbd5e1', fontSize: '0.9rem' }}>
                    Annual Income (₹)
                  </label>
                  <input
                    type="number"
                    min="0"
                    step="100000"
                    value={annualIncome}
                    onChange={(e) => setAnnualIncome(Number(e.target.value))}
                  />
                </div>

                <div className="input-group" style={{ marginBottom: 0 }}>
                  <label style={{ fontWeight: 600, color: '#cbd5e1', fontSize: '0.9rem' }}>
                    Existing Monthly EMI (₹)
                  </label>
                  <input
                    type="number"
                    min="0"
                    step="1000"
                    value={existingEMI}
                    onChange={(e) => setExistingEMI(Number(e.target.value))}
                  />
                </div>
              </div>
            )}

            {/* Compare Button */}
            <button
              className="btn-secondary"
              onClick={addToComparison}
              style={{
                width: '100%',
                marginTop: '1.5rem',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: '0.5rem'
              }}
            >
              <RefreshCw size={18} />
              Add to Comparison ({comparison.length}/4)
            </button>
          </div>

          {/* Right Column - Results Display */}
          <div>
            {/* Key Metrics */}
            <div style={{
              display: 'grid',
              gridTemplateColumns: '1fr 1fr',
              gap: '1rem',
              marginBottom: '2rem'
            }}>
              <div className={`metric-card ${isCalculating ? 'calculating' : ''}`}>
                <div style={{ fontSize: '0.875rem', color: '#94a3b8', marginBottom: '0.5rem', fontWeight: 600 }}>
                  Monthly EMI
                </div>
                <div style={{
                  fontSize: '2rem',
                  fontWeight: 800,
                  color: '#fbbf24',
                  fontFamily: "'Outfit', sans-serif"
                }}>
                  {formatINR(emi)}
                </div>
              </div>

              <div className="metric-card">
                <div style={{ fontSize: '0.875rem', color: '#94a3b8', marginBottom: '0.5rem', fontWeight: 600 }}>
                  Principal Amount
                </div>
                <div style={{
                  fontSize: '1.5rem',
                  fontWeight: 700,
                  color: '#3b82f6'
                }}>
                  {formatINR(principal)}
                </div>
              </div>

              <div className="metric-card">
                <div style={{ fontSize: '0.875rem', color: '#94a3b8', marginBottom: '0.5rem', fontWeight: 600 }}>
                  Total Interest
                </div>
                <div style={{
                  fontSize: '1.5rem',
                  fontWeight: 700,
                  color: '#ef4444'
                }}>
                  {formatINR(totalInterest)}
                </div>
              </div>

              <div className="metric-card">
                <div style={{ fontSize: '0.875rem', color: '#94a3b8', marginBottom: '0.5rem', fontWeight: 600 }}>
                  Total Payable
                </div>
                <div style={{
                  fontSize: '1.5rem',
                  fontWeight: 700,
                  color: '#10b981'
                }}>
                  {formatINR(totalAmount)}
                </div>
              </div>
            </div>

            {/* Tab Content */}
            {activeTab === 'calculator' && (
              <div className="calculator-card">
                <h3 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>
                  Loan Breakdown
                </h3>

                {/* Pie Chart */}
                <ResponsiveContainer width="100%" height={300}>
                  <PieChart>
                    <Pie
                      data={[
                        { name: 'Principal', value: principal, color: '#3b82f6' },
                        { name: 'Interest', value: totalInterest, color: '#ef4444' }
                      ]}
                      cx="50%"
                      cy="50%"
                      labelLine={false}
                      label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(1)}%`}
                      outerRadius={100}
                      fill="#8884d8"
                      dataKey="value"
                    >
                      <Cell fill="#3b82f6" />
                      <Cell fill="#ef4444" />
                    </Pie>
                    <Tooltip formatter={(value) => formatINR(value)} />
                  </PieChart>
                </ResponsiveContainer>

                {/* Additional Info */}
                <div style={{
                  marginTop: '2rem',
                  padding: '1.5rem',
                  background: 'rgba(15, 23, 42, 0.5)',
                  borderRadius: '12px'
                }}>
                  <div style={{ display: 'grid', gap: '1rem' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                      <span style={{ color: '#94a3b8' }}>Processing Fee ({processingFee}%)</span>
                      <span style={{ fontWeight: 700 }}>{formatINR(processingFeeAmount)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                      <span style={{ color: '#94a3b8' }}>Total Insurance</span>
                      <span style={{ fontWeight: 700 }}>{formatINR(insurance * 12 * tenure)}</span>
                    </div>
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      paddingTop: '1rem',
                      borderTop: '1px solid rgba(148, 163, 184, 0.2)'
                    }}>
                      <span style={{ color: '#fbbf24', fontWeight: 700 }}>Total Cost</span>
                      <span style={{ fontWeight: 800, fontSize: '1.25rem', color: '#fbbf24' }}>
                        {formatINR(totalCost)}
                      </span>
                    </div>
                  </div>
                </div>

                {/* Year-wise Chart */}
                <div style={{ marginTop: '2rem' }}>
                  <h4 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#cbd5e1' }}>
                    Principal vs Interest Over Time
                  </h4>
                  <ResponsiveContainer width="100%" height={250}>
                    <AreaChart data={generateAmortization.slice(0, 10)}>
                      <defs>
                        <linearGradient id="colorPrincipal" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.8}/>
                          <stop offset="95%" stopColor="#3b82f6" stopOpacity={0.1}/>
                        </linearGradient>
                        <linearGradient id="colorInterest" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                          <stop offset="95%" stopColor="#ef4444" stopOpacity={0.1}/>
                        </linearGradient>
                      </defs>
                      <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                      <XAxis dataKey="year" stroke="#64748b" />
                      <YAxis stroke="#64748b" tickFormatter={(value) => `₹${(value/100000).toFixed(0)}L`} />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: '#1e293b',
                          border: '1px solid #334155',
                          borderRadius: '8px'
                        }}
                        formatter={(value) => formatINR(value)}
                      />
                      <Legend />
                      <Area
                        type="monotone"
                        dataKey="yearPrincipal"
                        name="Principal"
                        stroke="#3b82f6"
                        fillOpacity={1}
                        fill="url(#colorPrincipal)"
                      />
                      <Area
                        type="monotone"
                        dataKey="yearInterest"
                        name="Interest"
                        stroke="#ef4444"
                        fillOpacity={1}
                        fill="url(#colorInterest)"
                      />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>
            )}

            {activeTab === 'schedule' && (
              <div className="calculator-card">
                <h3 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>
                  Year-wise Amortization Schedule
                </h3>

                <div style={{
                  maxHeight: '600px',
                  overflowY: 'auto',
                  border: '1px solid rgba(148, 163, 184, 0.1)',
                  borderRadius: '12px'
                }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                    <thead style={{
                      position: 'sticky',
                      top: 0,
                      background: '#1e293b',
                      zIndex: 1
                    }}>
                      <tr>
                        <th style={{ padding: '1rem', textAlign: 'left', fontSize: '0.875rem', fontWeight: 700, color: '#fbbf24' }}>Year</th>
                        <th style={{ padding: '1rem', textAlign: 'right', fontSize: '0.875rem', fontWeight: 700, color: '#fbbf24' }}>Principal</th>
                        <th style={{ padding: '1rem', textAlign: 'right', fontSize: '0.875rem', fontWeight: 700, color: '#fbbf24' }}>Interest</th>
                        <th style={{ padding: '1rem', textAlign: 'right', fontSize: '0.875rem', fontWeight: 700, color: '#fbbf24' }}>Balance</th>
                      </tr>
                    </thead>
                    <tbody>
                      {generateAmortization.map((row, index) => (
                        <tr key={row.year} className="table-row">
                          <td style={{ padding: '1rem', fontWeight: 600 }}>{row.year}</td>
                          <td style={{ padding: '1rem', textAlign: 'right', color: '#3b82f6' }}>
                            {formatINR(row.yearPrincipal)}
                          </td>
                          <td style={{ padding: '1rem', textAlign: 'right', color: '#ef4444' }}>
                            {formatINR(row.yearInterest)}
                          </td>
                          <td style={{ padding: '1rem', textAlign: 'right', color: '#94a3b8' }}>
                            {formatINR(row.balance)}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                {/* Cumulative Chart */}
                <div style={{ marginTop: '2rem' }}>
                  <h4 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#cbd5e1' }}>
                    Cumulative Payment Progress
                  </h4>
                  <ResponsiveContainer width="100%" height={250}>
                    <LineChart data={generateAmortization}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                      <XAxis dataKey="year" stroke="#64748b" />
                      <YAxis stroke="#64748b" tickFormatter={(value) => `₹${(value/100000).toFixed(0)}L`} />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: '#1e293b',
                          border: '1px solid #334155',
                          borderRadius: '8px'
                        }}
                        formatter={(value) => formatINR(value)}
                      />
                      <Legend />
                      <Line
                        type="monotone"
                        dataKey="cumulativePrincipal"
                        name="Cumulative Principal"
                        stroke="#3b82f6"
                        strokeWidth={3}
                        dot={false}
                      />
                      <Line
                        type="monotone"
                        dataKey="cumulativeInterest"
                        name="Cumulative Interest"
                        stroke="#ef4444"
                        strokeWidth={3}
                        dot={false}
                      />
                      <Line
                        type="monotone"
                        dataKey="totalPaid"
                        name="Total Paid"
                        stroke="#fbbf24"
                        strokeWidth={3}
                        dot={false}
                      />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>
            )}

            {activeTab === 'prepayment' && (
              <div className="calculator-card">
                <h3 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>
                  Prepayment Analysis
                </h3>

                <div className="input-group">
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                    <label style={{ fontWeight: 600, color: '#cbd5e1' }}>Prepayment Amount</label>
                    <span style={{
                      fontSize: '1.25rem',
                      fontWeight: 700,
                      color: '#fbbf24'
                    }}>{formatINR(prepaymentAmount)}</span>
                  </div>
                  <input
                    type="range"
                    className="slider"
                    min="0"
                    max={principal * 0.5}
                    step="10000"
                    value={prepaymentAmount}
                    onChange={(e) => setPrepaymentAmount(Number(e.target.value))}
                  />
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.875rem', color: '#64748b' }}>
                    <span>₹0</span>
                    <span>{formatINR(principal * 0.5)}</span>
                  </div>
                </div>

                <div className="input-group">
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                    <label style={{ fontWeight: 600, color: '#cbd5e1' }}>Prepayment Year</label>
                    <span style={{
                      fontSize: '1.25rem',
                      fontWeight: 700,
                      color: '#fbbf24'
                    }}>Year {prepaymentYear}</span>
                  </div>
                  <input
                    type="range"
                    className="slider"
                    min="1"
                    max={tenure}
                    step="1"
                    value={prepaymentYear}
                    onChange={(e) => setPrepaymentYear(Number(e.target.value))}
                  />
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', fontSize: '0.875rem', color: '#64748b' }}>
                    <span>Year 1</span>
                    <span>Year {tenure}</span>
                  </div>
                </div>

                {calculateWithPrepayment && prepaymentAmount > 0 && (
                  <div>
                    <div style={{
                      background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.1) 100%)',
                      border: '1px solid rgba(16, 185, 129, 0.3)',
                      borderRadius: '12px',
                      padding: '1.5rem',
                      marginTop: '1.5rem'
                    }}>
                      <h4 style={{
                        fontSize: '1.1rem',
                        color: '#10b981',
                        marginBottom: '1rem',
                        fontWeight: 700
                      }}>
                        Prepayment Benefits
                      </h4>

                      <div style={{ display: 'grid', gap: '1rem' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ color: '#94a3b8' }}>New Tenure</span>
                          <span style={{ fontWeight: 700, color: '#10b981' }}>
                            {calculateWithPrepayment.newTenure} years
                          </span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ color: '#94a3b8' }}>Time Saved</span>
                          <span style={{ fontWeight: 700, color: '#10b981' }}>
                            {calculateWithPrepayment.savedYears} years {calculateWithPrepayment.remainingMonths} months
                          </span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ color: '#94a3b8' }}>Interest Saved</span>
                          <span style={{ fontWeight: 800, fontSize: '1.25rem', color: '#10b981' }}>
                            {formatINR(calculateWithPrepayment.savedInterest)}
                          </span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span style={{ color: '#94a3b8' }}>Total Cost</span>
                          <span style={{ fontWeight: 700 }}>
                            {formatINR(calculateWithPrepayment.totalPaid)}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Comparison Chart */}
                    <div style={{ marginTop: '2rem' }}>
                      <ResponsiveContainer width="100%" height={300}>
                        <BarChart data={[
                          {
                            name: 'Without Prepayment',
                            Principal: principal,
                            Interest: totalInterest,
                            Total: totalAmount
                          },
                          {
                            name: 'With Prepayment',
                            Principal: principal + prepaymentAmount,
                            Interest: calculateWithPrepayment.totalPaid - principal - prepaymentAmount,
                            Total: calculateWithPrepayment.totalPaid
                          }
                        ]}>
                          <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                          <XAxis dataKey="name" stroke="#64748b" />
                          <YAxis stroke="#64748b" tickFormatter={(value) => `₹${(value/100000).toFixed(0)}L`} />
                          <Tooltip
                            contentStyle={{
                              backgroundColor: '#1e293b',
                              border: '1px solid #334155',
                              borderRadius: '8px'
                            }}
                            formatter={(value) => formatINR(value)}
                          />
                          <Legend />
                          <Bar dataKey="Principal" stackId="a" fill="#3b82f6" />
                          <Bar dataKey="Interest" stackId="a" fill="#ef4444" />
                        </BarChart>
                      </ResponsiveContainer>
                    </div>
                  </div>
                )}

                {prepaymentAmount === 0 && (
                  <div style={{
                    textAlign: 'center',
                    padding: '3rem 1rem',
                    color: '#64748b'
                  }}>
                    <Info size={48} style={{ marginBottom: '1rem', opacity: 0.5 }} />
                    <p>Set a prepayment amount to see the benefits analysis</p>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'eligibility' && (
              <div className="calculator-card">
                <h3 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>
                  Loan Eligibility Analysis
                </h3>

                <div style={{
                  background: eligibility.isEligible
                    ? 'linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.1) 100%)'
                    : 'linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%)',
                  border: `1px solid ${eligibility.isEligible ? 'rgba(16, 185, 129, 0.3)' : 'rgba(239, 68, 68, 0.3)'}`,
                  borderRadius: '12px',
                  padding: '1.5rem',
                  marginBottom: '1.5rem'
                }}>
                  <div style={{
                    fontSize: '1.25rem',
                    fontWeight: 700,
                    color: eligibility.isEligible ? '#10b981' : '#ef4444',
                    marginBottom: '1rem'
                  }}>
                    {eligibility.isEligible ? '✓ Eligible' : '✗ Not Eligible'}
                  </div>
                  <p style={{ color: '#94a3b8', fontSize: '0.95rem' }}>
                    Based on 50% Fixed Obligation to Income Ratio (FOIR)
                  </p>
                </div>

                <div style={{
                  display: 'grid',
                  gap: '1rem',
                  padding: '1.5rem',
                  background: 'rgba(15, 23, 42, 0.5)',
                  borderRadius: '12px'
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Monthly Income</span>
                    <span style={{ fontWeight: 700 }}>{formatINR(annualIncome / 12)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Existing EMI</span>
                    <span style={{ fontWeight: 700 }}>{formatINR(existingEMI)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Maximum Eligible EMI</span>
                    <span style={{ fontWeight: 700, color: '#3b82f6' }}>{formatINR(eligibility.maxEMI)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Current EMI</span>
                    <span style={{ fontWeight: 700, color: emi > eligibility.maxEMI ? '#ef4444' : '#10b981' }}>
                      {formatINR(emi)}
                    </span>
                  </div>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    paddingTop: '1rem',
                    borderTop: '1px solid rgba(148, 163, 184, 0.2)'
                  }}>
                    <span style={{ color: '#94a3b8' }}>EMI Utilization</span>
                    <span style={{
                      fontWeight: 800,
                      fontSize: '1.25rem',
                      color: eligibility.utilizationRatio < 80 ? '#10b981' : '#ef4444'
                    }}>
                      {eligibility.utilizationRatio}%
                    </span>
                  </div>
                </div>

                <div style={{ marginTop: '1.5rem' }}>
                  <div style={{ marginBottom: '0.5rem', display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#cbd5e1', fontWeight: 600 }}>EMI to Income Ratio</span>
                    <span style={{ color: '#fbbf24' }}>{eligibility.utilizationRatio}%</span>
                  </div>
                  <div style={{
                    background: '#1e293b',
                    borderRadius: '8px',
                    height: '24px',
                    overflow: 'hidden',
                    border: '1px solid rgba(148, 163, 184, 0.2)'
                  }}>
                    <div style={{
                      height: '100%',
                      width: `${Math.min(eligibility.utilizationRatio, 100)}%`,
                      background: eligibility.utilizationRatio < 50
                        ? 'linear-gradient(90deg, #10b981, #059669)'
                        : eligibility.utilizationRatio < 80
                        ? 'linear-gradient(90deg, #fbbf24, #f59e0b)'
                        : 'linear-gradient(90deg, #ef4444, #dc2626)',
                      transition: 'width 0.5s ease-out'
                    }}></div>
                  </div>
                </div>

                <div style={{
                  marginTop: '2rem',
                  padding: '1.5rem',
                  background: 'rgba(59, 130, 246, 0.1)',
                  borderRadius: '12px',
                  border: '1px solid rgba(59, 130, 246, 0.2)'
                }}>
                  <div style={{ fontSize: '1.1rem', fontWeight: 700, marginBottom: '1rem', color: '#3b82f6' }}>
                    Maximum Eligible Loan
                  </div>
                  <div style={{ fontSize: '2rem', fontWeight: 800, color: '#fbbf24' }}>
                    {formatINR(eligibility.eligibleLoan)}
                  </div>
                  {eligibility.eligibleLoan < principal && (
                    <p style={{ marginTop: '1rem', color: '#ef4444', fontSize: '0.9rem' }}>
                      ⚠ Current loan amount exceeds eligibility by {formatINR(principal - eligibility.eligibleLoan)}
                    </p>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'tax' && (
              <div className="calculator-card">
                <h3 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>
                  Tax Benefits (Year 1)
                </h3>

                <div style={{
                  background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%)',
                  border: '1px solid rgba(139, 92, 246, 0.3)',
                  borderRadius: '12px',
                  padding: '1.5rem',
                  marginBottom: '1.5rem'
                }}>
                  <div style={{
                    fontSize: '0.875rem',
                    color: '#a78bfa',
                    marginBottom: '0.5rem',
                    fontWeight: 600
                  }}>
                    Total Tax Saving (30% bracket)
                  </div>
                  <div style={{
                    fontSize: '2.5rem',
                    fontWeight: 800,
                    color: '#8b5cf6'
                  }}>
                    {formatINR(taxBenefits.taxSaved)}
                  </div>
                  <p style={{ marginTop: '0.5rem', color: '#94a3b8', fontSize: '0.9rem' }}>
                    Effective EMI after tax benefit: {formatINR(emi - (taxBenefits.taxSaved / 12))}
                  </p>
                </div>

                <div style={{
                  display: 'grid',
                  gap: '1rem',
                  padding: '1.5rem',
                  background: 'rgba(15, 23, 42, 0.5)',
                  borderRadius: '12px'
                }}>
                  <h4 style={{ fontSize: '1.1rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>
                    Section 80C - Principal Repayment
                  </h4>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Principal Paid (Year 1)</span>
                    <span style={{ fontWeight: 700 }}>{formatINR(generateAmortization[0]?.yearPrincipal || 0)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Maximum Deduction</span>
                    <span style={{ fontWeight: 700 }}>₹1,50,000</span>
                  </div>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    paddingTop: '1rem',
                    borderTop: '1px solid rgba(148, 163, 184, 0.2)'
                  }}>
                    <span style={{ color: '#a78bfa', fontWeight: 700 }}>Eligible Deduction</span>
                    <span style={{ fontWeight: 800, color: '#a78bfa' }}>
                      {formatINR(taxBenefits.principalDeduction)}
                    </span>
                  </div>
                </div>

                <div style={{
                  display: 'grid',
                  gap: '1rem',
                  padding: '1.5rem',
                  background: 'rgba(15, 23, 42, 0.5)',
                  borderRadius: '12px',
                  marginTop: '1rem'
                }}>
                  <h4 style={{ fontSize: '1.1rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>
                    Section 24(b) - Interest Payment
                  </h4>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Interest Paid (Year 1)</span>
                    <span style={{ fontWeight: 700 }}>{formatINR(generateAmortization[0]?.yearInterest || 0)}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    <span style={{ color: '#94a3b8' }}>Maximum Deduction</span>
                    <span style={{ fontWeight: 700 }}>₹2,00,000</span>
                  </div>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    paddingTop: '1rem',
                    borderTop: '1px solid rgba(148, 163, 184, 0.2)'
                  }}>
                    <span style={{ color: '#a78bfa', fontWeight: 700 }}>Eligible Deduction</span>
                    <span style={{ fontWeight: 800, color: '#a78bfa' }}>
                      {formatINR(taxBenefits.interestDeduction)}
                    </span>
                  </div>
                </div>

                <div style={{
                  marginTop: '1.5rem',
                  padding: '1rem',
                  background: 'rgba(59, 130, 246, 0.1)',
                  borderRadius: '8px',
                  border: '1px solid rgba(59, 130, 246, 0.2)'
                }}>
                  <div style={{ fontSize: '0.875rem', color: '#60a5fa', marginBottom: '0.5rem' }}>
                    ℹ Additional Benefits
                  </div>
                  <ul style={{ margin: 0, paddingLeft: '1.5rem', color: '#94a3b8', fontSize: '0.9rem', lineHeight: 1.6 }}>
                    <li>First-time home buyers get additional ₹50,000 deduction under Section 80EEA</li>
                    <li>Affordable housing (up to ₹45L) gets extra ₹1.5L deduction under Section 80EEA</li>
                    <li>Tax benefits continue throughout the loan tenure</li>
                  </ul>
                </div>

                {/* 10-year projection */}
                <div style={{ marginTop: '2rem' }}>
                  <h4 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#cbd5e1' }}>
                    10-Year Tax Benefit Projection
                  </h4>
                  <ResponsiveContainer width="100%" height={250}>
                    <BarChart data={generateAmortization.slice(0, 10).map(row => ({
                      year: `Year ${row.year}`,
                      principalBenefit: Math.min(row.yearPrincipal, 150000) * 0.3,
                      interestBenefit: Math.min(row.yearInterest, 200000) * 0.3
                    }))}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                      <XAxis dataKey="year" stroke="#64748b" />
                      <YAxis stroke="#64748b" tickFormatter={(value) => `₹${(value/1000).toFixed(0)}K`} />
                      <Tooltip
                        contentStyle={{
                          backgroundColor: '#1e293b',
                          border: '1px solid #334155',
                          borderRadius: '8px'
                        }}
                        formatter={(value) => formatINR(value)}
                      />
                      <Legend />
                      <Bar dataKey="principalBenefit" name="Principal Tax Saving" fill="#8b5cf6" />
                      <Bar dataKey="interestBenefit" name="Interest Tax Saving" fill="#a78bfa" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Comparison Section */}
        {comparison.length > 0 && (
          <div className="calculator-card" style={{ marginTop: '2rem' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
              <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>
                Scenario Comparison
              </h3>
              <button
                onClick={() => setComparison([])}
                className="btn-secondary"
              >
                Clear All
              </button>
            </div>

            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead>
                  <tr style={{ borderBottom: '2px solid rgba(148, 163, 184, 0.2)' }}>
                    <th style={{ padding: '1rem', textAlign: 'left', fontWeight: 700, color: '#fbbf24' }}>Scenario</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>Loan Amount</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>Rate</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>Tenure</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>EMI</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>Total Interest</th>
                    <th style={{ padding: '1rem', textAlign: 'right', fontWeight: 700, color: '#fbbf24' }}>Total Payable</th>
                    <th style={{ padding: '1rem' }}></th>
                  </tr>
                </thead>
                <tbody>
                  {comparison.map((scenario, index) => (
                    <tr key={scenario.id} className="table-row">
                      <td style={{ padding: '1rem', fontWeight: 600 }}>Scenario {index + 1}</td>
                      <td style={{ padding: '1rem', textAlign: 'right' }}>{formatINR(scenario.principal)}</td>
                      <td style={{ padding: '1rem', textAlign: 'right' }}>{scenario.rate}%</td>
                      <td style={{ padding: '1rem', textAlign: 'right' }}>{scenario.tenure}Y</td>
                      <td style={{ padding: '1rem', textAlign: 'right', color: '#fbbf24', fontWeight: 700 }}>
                        {formatINR(scenario.emi)}
                      </td>
                      <td style={{ padding: '1rem', textAlign: 'right', color: '#ef4444' }}>
                        {formatINR(scenario.totalInterest)}
                      </td>
                      <td style={{ padding: '1rem', textAlign: 'right', fontWeight: 700 }}>
                        {formatINR(scenario.totalAmount)}
                      </td>
                      <td style={{ padding: '1rem' }}>
                        <button
                          onClick={() => setComparison(comparison.filter(s => s.id !== scenario.id))}
                          style={{
                            background: 'transparent',
                            border: 'none',
                            color: '#ef4444',
                            cursor: 'pointer',
                            padding: '0.5rem'
                          }}
                        >
                          ✕
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Comparison Chart */}
            {comparison.length > 1 && (
              <div style={{ marginTop: '2rem' }}>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={comparison.map((s, i) => ({
                    name: `Scenario ${i + 1}`,
                    EMI: s.emi,
                    'Total Interest': s.totalInterest,
                    'Total Amount': s.totalAmount
                  }))}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis dataKey="name" stroke="#64748b" />
                    <YAxis stroke="#64748b" tickFormatter={(value) => `₹${(value/100000).toFixed(0)}L`} />
                    <Tooltip
                      contentStyle={{
                        backgroundColor: '#1e293b',
                        border: '1px solid #334155',
                        borderRadius: '8px'
                      }}
                      formatter={(value) => formatINR(value)}
                    />
                    <Legend />
                    <Bar dataKey="EMI" fill="#fbbf24" />
                    <Bar dataKey="Total Interest" fill="#ef4444" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}
          </div>
        )}

        {/* Footer */}
        <div style={{
          marginTop: '3rem',
          textAlign: 'center',
          color: '#64748b',
          fontSize: '0.875rem',
          padding: '2rem',
          borderTop: '1px solid rgba(148, 163, 184, 0.1)'
        }}>
          <p style={{ marginBottom: '0.5rem' }}>
            ⚠ This calculator provides estimates only. Actual loan terms may vary based on lender policies.
          </p>
          <p>
            Tax benefits are subject to applicable laws and your tax bracket. Consult a financial advisor for personalized advice.
          </p>
        </div>
      </div>
    </div>
  );
}
